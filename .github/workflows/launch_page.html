<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>Glitch</title>
   <script>
      document.addEventListener("DOMContentLoaded",async function(){
        await navigator.serviceWorker.register('sw.js');
      })

    </script>
  <meta name="googlebot" content="index, follow, snippet">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="stylesheet" href="scripts/css/global.css">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@250" rel="stylesheet">
  <script src="uv/uv.bundle.js" defer></script>
  <script src="uv/uv.config.js" defer></script>
<script>
        await navigator.serviceWorker.register('sw.js');
     
    </script>
  <style>
/* ✨ SLEEK & MODERN DARK THEME FOR IFRAME VIEWER ✨ */

/* -------------------------------------------------- */
/* ✨ Root Variables - THEME CUSTOMIZATION ✨ */
/* -------------------------------------------------- */
:root {
  /* Primary Dark Theme Palette */
  --color-background: #121212;         /* Deeper Dark Background */
  --color-surface: #1e1e1e;            /* Slightly Lighter Surface for Searchbar, etc. */
  --color-primary: #bb86fc;            /* Purple -  Primary Accent Color */
  --color-secondary: #03dac5;          /* Teal - Secondary Accent Color */
  --color-text-primary: #ffffff;       /* White - Primary Text Color */
  --color-text-secondary: #aaaaaa;     /* Light Grey - Secondary Text/Hints */
  --color-accent: var(--color-primary); /* Default Accent is Primary */

  /* UI Elements & Spacing */
  --spacing-unit: 10px;               /* Base Spacing Unit */
  --padding-base: calc(var(--spacing-unit) * 0.8); /* Standard Padding */
  --margin-base: var(--spacing-unit);  /* Standard Margin */
  --border-radius-base: 8px;          /* Rounded Corners for UI elements */
  --toolbar-height: 50px;              /* Height of the search bar/toolbar */

  /* Shadows & Effects */
  --box-shadow-normal: 0 2px 5px rgba(0, 0, 0, 0.2); /* Subtle Shadow */
  --box-shadow-hover: 0 4px 10px rgba(0, 0, 0, 0.3);/* Stronger Shadow on Hover */
  --transition-duration: 0.3s;        /* Standard Transition Duration */
  --transition-easing: ease-in-out;   /* Standard Transition Easing */
}


/* -------------------------------------------------- */
/* ✨ Base Styles - Body and Font ✨ */
/* -------------------------------------------------- */
body {
  background-color: var(--color-background);
  color: var(--color-text-primary);
  margin: 0;
  overflow: hidden; /* Hide scrollbars for cleaner look */
  font-family: sans-serif; /* System font or preferred font */
  -webkit-font-smoothing: antialiased; /* Improve font rendering on macOS */
  -moz-osx-font-smoothing: grayscale;   /* Improve font rendering on Firefox macOS */
}


/* -------------------------------------------------- */
/* ✨ Search Bar - Fixed at Top ✨ */
/* -------------------------------------------------- */
#searchbar {
  background-color: var(--color-surface); /* Darker surface for search bar */
  width: 100%;
  display: flex;
  justify-content: center; /* Center content horizontally */
  align-items: center;     /* Center content vertically */
  height: var(--toolbar-height);
  position: fixed; /* Fixed position at the top */
  top: 0;
  z-index: 15; /* Ensure it's above iframe */
  box-sizing: border-box;
  padding: 0 var(--padding-base);
  box-shadow: var(--box-shadow-normal); /* Add subtle shadow */
}


/* Search Input Field */
#searchbar input {
  background-color: #2a2a2a; /* Slightly lighter than surface, input background */
  color: var(--color-text-primary);
  border: none;
  border-radius: var(--border-radius-base);
  padding: var(--padding-base) calc(var(--padding-base) * 2); /* More horizontal padding */
  width: 60%; /* Wider search bar */
  min-width: 250px; /* Minimum width for responsiveness */
  box-sizing: border-box;
  font-size: 1rem;
  transition: background-color var(--transition-duration) var(--transition-easing),
              box-shadow var(--transition-duration) var(--transition-easing);
}

#searchbar input::placeholder {
  color: var(--color-text-secondary); /* Grey placeholder text */
  opacity: 0.7;
}

#searchbar input:focus {
  outline: none; /* Remove default focus outline */
  background-color: #333; /* Slightly lighter on focus */
  box-shadow: var(--box-shadow-hover); /* Stronger shadow on focus */
}


/* -------------------------------------------------- */
/* ✨ Iframe Container - Below Search Bar ✨ */
/* -------------------------------------------------- */
#uv-frame {
  width: 100%;
  height: calc(100vh - var(--toolbar-height)); /* Adjust height to fill viewport below toolbar */
  border: none; /* Remove default iframe border */
  position: fixed; /* Fixed to viewport */
  top: var(--toolbar-height); /* Position below search bar */
  left: 0;
}

iframe {
  background-color: var(--color-surface); /* Match iframe background to surface for seamless look, or can be 'transparent' */
}


/* -------------------------------------------------- */
/* ✨ Toolbar Icons - Home, Refresh, etc. ✨ */
/* -------------------------------------------------- */
#home, #refresh {
  margin-right: calc(var(--margin-base) * 1.5); /* Spacing between icons and input */
  filter: invert(90%) sepia(10%) saturate(200%) hue-rotate(250deg) brightness(100%) contrast(90%); /* Soft purple tint, adjust filter for desired color */
  opacity: 0.7; /* Slightly faded icons */
  cursor: pointer;
  transition: opacity var(--transition-duration) var(--transition-easing),
              filter var(--transition-duration) var(--transition-easing); /* Smooth transition */
}

#home:hover, #refresh:hover {
  opacity: 1; /* Fully visible on hover */
  filter: invert(95%) sepia(20%) saturate(300%) hue-rotate(260deg) brightness(110%) contrast(100%); /* Slightly brighter purple on hover */
}


/* Generic Image Styling (Consider using more specific classes if other images are present) */
img {
  width: 24px; /* Slightly larger icons */
  margin-left: calc(var(--margin-base) * 1.5); /* Spacing for icons on the left if any */
  cursor: pointer;
}


/* -------------------------------------------------- */
/* ✨ Loader Animation - Centered and Modern ✨ */
/* -------------------------------------------------- */
.loader {
  width: 36px; /* Slightly smaller loader */
  height: 36px; /* Slightly smaller loader */
  border: 4px solid; /* Thinner border */
  border-color: var(--color-primary) transparent; /* Brand color for loader */
  border-radius: 50%;
  display: inline-block;
  box-sizing: border-box;
  animation: rotation 1.2s linear infinite; /* Slightly slower animation */
  margin-left: calc(var(--margin-base) * 1.5); /* Spacing if loader is next to other elements */
}

@keyframes rotation {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}


/* -------------------------------------------------- */
/* ✨ Country Flag Element - Right Aligned & Stylish ✨ */
/* -------------------------------------------------- */
.country-flag {
  position: absolute; /* Positioned to the right of search bar */
  right: var(--padding-base); /* Spacing from right edge */
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: rgba(255, 255, 255, 0.05); /* Very subtle white overlay */
  padding: var(--padding-base) calc(var(--padding-base) * 1.5); /* Adjusted padding */
  border-radius: calc(var(--border-radius-base) * 2); /* More rounded corners */
  border: 1px solid rgba(255, 255, 255, 0.1); /* Very subtle white border */
  box-shadow: var(--box-shadow-normal); /* Subtle shadow */
  backdrop-filter: blur(10px); /* Stronger blur effect for glassmorphism */
  transition: background-color var(--transition-duration) var(--transition-easing),
              border-color var(--transition-duration) var(--transition-easing);
}

.country-flag:hover {
  background-color: rgba(255, 255, 255, 0.1); /* Slightly more visible on hover */
  border-color: rgba(255, 255, 255, 0.2); /* Slightly more visible border on hover */
}


/* Country Flag Image */
.country-flag img {
  height: 24px; /* Slightly larger flag image */
  width: auto;
  margin-right: calc(var(--margin-base) * 0.8); /* Adjusted spacing between flag and text */
  border-radius: 3px; /* Slightly rounded flag image corners */
}


/* Country Flag Text (Country Code) */
.country-flag span {
  color: var(--color-text-primary);
  font-weight: 500; /* Slightly bolder text */
  letter-spacing: 0.5px; /* Slightly tighter letter spacing */
  font-size: 0.9rem;
  opacity: 0.9; /* Slightly less opaque text */
}
  </style>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-278K4F012J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-278K4F012J');
  </script>
</head>
<body>
  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    
      try {
        await navigator.serviceWorker.register('sw.js');
        console.log("Registered!")
      } catch (err) {
        console.warn("Failed to register service worker:", err);
      }


    });
</script>
  <div id="searchbar">
    <span id="refresh" onclick="location.reload()" class="material-symbols-outlined" style="margin-right: 25px; color: black;">refresh</span>
    <input id="search" oninput="search()" placeholder="Input a URL or search..." type="search"/>
    <span onclick="navigateToPage()" class="material-symbols-outlined" style="margin-left: 25px;">search</span>
    <span onclick="handle_eruda()" class="material-symbols-outlined" style="margin-left: 25px;">terminal</span>
    <span onclick="handle_fullscreen()" class="material-symbols-outlined" style="margin-left: 25px;">fullscreen</span>

    <div class="country-flag" title="The path proxies your connection is going through.">
      <span class="material-symbols-outlined" title="Your computer">
        computer
      </span>
      <span class="material-symbols-outlined">
        arrow_forward
      </span>
      
      <img id="main_flag" src="https://flagsapi.com/US/shiny/64.png">


      <div id="second_flag_div" style="display: none;">
      <span class="material-symbols-outlined">
        arrow_forward
      </span>
      <img id="second_flag" src="https://flagsapi.com/DE/shiny/64.png">
      </div>
      <span class="material-symbols-outlined" >
        arrow_forward
      </span>
      
      <span class="material-symbols-outlined" title="The destination.">
        dns
      </span>
      
    </div>
  </div>

  <div id="frames">
    <form id="uv-form" class="flex-center">
      <input id="uv-search-engine" value="https://www.google.com/search?q=%s" type="hidden">
      <input id="uv-address" type="hidden">
    </form>
    <iframe id="uv-frame"><script>document.addEventListener("DOMContentLoaded", async () => {
    
      try {
        await navigator.serviceWorker.register('sw.js');
        console.log("Registered!")
      } catch (err) {
        console.warn("Failed to register service worker:", err);
      }


    });</script></iframe>
  </div>

  <script>

const search_engine_preference = localStorage.getItem("search_engine") || "Google";
const proxy_bridge = localStorage.getItem("proxy");
const premium_status = localStorage.getItem("premium") === "true";
let suggestions = [];


      search_engine = "https://search.brave.com/search?q="    


async function set_flags() {
  if (premium_status && proxy_bridge && !proxy_bridge.includes("None")) {
    document.getElementById("second_flag_div").style.display = "block";
  }

  try {
    const response = await fetch('/region');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    let data = await response.json();
    document.getElementById("main_flag").src = `https://flagsapi.com/${data.country}/shiny/64.png`;
    document.getElementById("main_flag").title = `Server in ${data.region}, ${data.full_name}`;

    if (premium_status && proxy_bridge && !proxy_bridge.includes("None")) {
      function check() {
        switch (proxy_bridge) {
          case "Glitch EU Proxy":
            return "https://eu.glitchnetwork.xyz";
          case "12FT":
            return "https://12ft.io/";
          case "Archive.org/Wayback Machine":
            return "https://web.archive.org/";
          case "Google Cache":
            return "https://webcache.googleusercontent.com/search?q=cache:";
          default:
            return "";
        }
      }

      let proxy_url = check();
      if (proxy_url.includes("Glitch")) {
        proxy_url += "/region";
        const proxyResponse = await fetch(proxy_url);
        if (!proxyResponse.ok) {
          throw new Error('Network response was not ok');
        }

        data = await proxyResponse.json();
        document.getElementById("second_flag").src = `https://flagsapi.com/${data.country}/shiny/64.png`;
        document.getElementById("second_flag").title = `Server in ${data.region}, ${data.full_name}`;
      } else {
        document.getElementById("second_flag").src = `https://flagsapi.com/US/shiny/64.png`;
        document.getElementById("second_flag").title = `Cannot find location of Non-Glitch server.`;
      }
    }
  } catch (error) {
    console.error('Failed to fetch region data:', error);
  }
}

set_flags()


    let typing = 0;

    document.getElementById("search").addEventListener("focusin", () => typing = 1);
    document.getElementById("search").addEventListener("focusout", () => typing = 0);

    function getURLParameter(name) {
      const regex = new RegExp(`[\\?&]${name}=([^&#]*)`);
      const results = regex.exec(location.search);
      return results ? decodeURIComponent(results[1].replace(/\+/g, ' ')) : '';
    }

    document.getElementById("search").addEventListener("keydown",function(){
      if (event.key == "Enter"){
        navigateToPage()
      }
    })

    function navigateToPage() {
      const url = document.getElementById('search').value;
      window.location = `launch_page.html?url=${encodeURIComponent(url)}`;
    }

    document.getElementById("uv-frame").onload = () => {
      setInterval(updateDocumentTitle, 500);
    };

    function updateDocumentTitle() {
      const frame = document.getElementById("uv-frame");
      const frameTitle = frame.contentDocument ? frame.contentDocument.title : '';
      if (document.title !== frameTitle && frameTitle) {
        document.title = frameTitle + "|G|" + document.getElementById('search').value;
      }
    }

    setTimeout(() => {
      setInterval(() => {
        if (!typing) {
          try {
            const frame = document.getElementById("uv-frame");
          
            const decodedUrl = __uv$config.decodeUrl(frame.contentWindow.location.href.split("/assets-images/backgrounds/")[1]);
           
            if (decodedUrl && decodedUrl !== document.getElementById("search").value) {
              document.getElementById("search").value = decodedUrl;
            }
          } catch (e) {
            console.log(e);
          }
        }
      }, 500);
    }, 1000);


    const searchInput = document.querySelector("#search");
    const resultBox = document.createElement("ul");
    resultBox.classList.add("resultBox");
    searchInput.parentNode.appendChild(resultBox);

    searchInput.onkeyup = (e) => {
      let userData = e.target.value;
      if (userData) {
        fetch(`/search_complete/${encodeURIComponent(userData)}`)
          .then(response => response.json())
          .then(jsonData => {
            suggestions = jsonData[1] || [];
            showSuggestions(suggestions);
          });
      } else {
        resultBox.innerHTML = "";
      }
    };

    function showSuggestions(list) {
      resultBox.innerHTML = list.map(data => 
        `<li onclick="window.location='launch.html?url=${encodeURIComponent(search_engine_preference + data)}'">${data} - <span style='filter: opacity(0.4);'>${search_engine_preference} Search</span></li>`
      ).join('');
    }

    function handle_fullscreen() {
    const presets = {
        "Google Slides": "/assets/favicons/slides_favicon.png",
        "Google": "/assets/favicons/google_favicon.png",
        "I-Ready": "/assets/favicons/iready_favicon.png",
        "Clever": "/assets/favicons/clever_favicon.png",
        "FBI": "https://www.fbi.gov/++theme++fbigov.theme/images/fbi_seal_new.png",
        "Google Classroom": "/assets/favicons/classroom_favicon.png",
        "Github": "/assets/favicons/github_favicon.jpg",
        "Wikipedia": "/assets/favicons/wiki_favicon.png"
    };

    let preset = localStorage.getItem("autohide_preset") || "Google Classroom";

    let x = "/assets-images/backgrounds/" + __uv$config.encodeUrl(document.getElementById("search").value);
    
    let code = `
        <head>
          <title>${preset}</title>
          <link rel="icon" type="image/x-icon" href="${presets[preset]}">
        </head>
        <body style="background-color: black">
          <iframe src="${x}" frameborder="0" style="position: fixed; inset: 0; outline: none; border: none; height: 100%; width: 100%;"></iframe>
        </body>
    `;

    let newWindow = window.open("about:blank", "_blank");
    newWindow.document.write(code);
    newWindow.document.close(); // Ensure the document is complete and can be rendered
    newWindow.document.body.style.backgroundColor = "black";
}

    function buildSearchUrl(input, searchEngine, domains) {
      let url;
      try {
        if (!input.startsWith("http://") && !input.startsWith("https://") && input.includes(".")) {
          input = "https://" + input;
        }
        url = new URL(input).toString();
      } catch (err) {
        return `${searchEngine}${encodeURIComponent(input)}`;
      }

      if (url.includes("reddit.com")) {
        url = url.replace("reddit.com", "l.opnxng.com");
      }

      for (const domain of domains) {
        if (url.includes(domain.split("|")[0])) {
          url = domain.split("|")[1];
          break;
        }
      }

      if (premium_status && proxy_bridge) {
        if (!proxy_bridge.includes("None")){
        url = `${getProxyBridge(proxy_bridge)}${encodeURIComponent(url)}`;
        }
      }

      return url;
    }

    function getProxyBridge(proxyBridge) {
      switch (proxyBridge) {
        case "Glitch EU Proxy":
          return "https://eu.glitchnetwork.xyz";
        case "12FT":
          return "https://12ft.io/";
        case "Archive.org/Wayback Machine":
          return "https://web.archive.org/";
        case "Google Cache":
          return "https://webcache.googleusercontent.com/search?q=cache:";
        default:
          return "";
      }
    }

    let eruda_status = 0;

    function handle_eruda(){
      if (window.eruda == null){
        javascript:(function () { var script = document.createElement('script'); script.src="https://cdn.jsdelivr.net/npm/eruda"; document.body.append(script); script.onload = function () { eruda.init(); } })();
        window.eruda.show()
      }
      else{
        if (eruda_status == 0){
           window.eruda.show()
           eruda_status = 1
        }
        else{
        window.eruda.hide()
        eruda_status = 0
        }
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const address = document.getElementById("uv-address");
      address.value = getURLParameter("url");
      
      const domains = await fetchGlitchDomains();

      const url = buildSearchUrl(address.value, search_engine, domains);
      console.log(url)
      
      const frame = document.getElementById("uv-frame");
      frame.src = `${__uv$config.prefix}${__uv$config.encodeUrl(url)}`;
      frame.style.display = "block";

      try {
        await navigator.serviceWorker.register('sw.js');
        console.log("Registered!")
      } catch (err) {
        console.warn("Failed to register service worker:", err);
      }


    });



    async function fetchGlitchDomains() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/Glitch-Network/glitch_net_domains/main/db.txt");
        const data = await response.text();
        return data.split("\n").map(line => line.trim()).filter(Boolean);
      } catch (error) {
        console.log("Glitch domains unavailable.");
        return [];
      }
    }
  </script>
</body>
</html>
